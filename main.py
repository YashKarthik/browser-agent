from playwright.sync_api import sync_playwright, Locator
import openai
from time import sleep

"""
Next steps:
    - Create a structure that is conveniently maps integer ids (generated by us) to Locator objects.
    - We send the simplified view, list of these elements to GPT.
    - GPT responds with ACTION and ID.
    - Where ACTION corresponds to actions we've implemented.
    - We perform the action on an element by grabbing it from our struct.
    - Since the struct contains `Locator`s, we can do the action on it directly using Playwright.

Later:
    - Internal monologue.
"""

class Crawler:
    def __init__(self):
        p = sync_playwright().start()
        self.browser = p.chromium.launch(headless=False)
        self.page = self.browser.new_page()
        self.elements: dict[int, Locator] = {}

    def go_to_page(self, url: str):
        self.page.goto(url)

    def test_crawl(self):
        l = self.page.query_selector_all("button")
        for ll in l:
            print(ll.get_attribute("id"))


if __name__ == "__main__":
    crawler = Crawler()
    crawler.go_to_page("https://www.reddit.com")
    crawler.test_crawl()

    sleep(5)
    crawler.browser.close()
